---
import BaseLayout from "../layouts/base-layout.astro"
import PostList from "../components/post-list.astro"
import WorkList from "../components/work-list.astro"

import { Image } from 'astro:assets';
import { sanityClient, urlFor } from '../lib/sanity/client';

// Fetch the singleton "home" document by ID
const home = await sanityClient.fetch(`*[_type == "home" && _id == "home"][0]`);

const heroUrl = urlFor(home.heroImage).auto('format').url()
// Get aspect ratio to calculate height
// const { width, height } = home.heroImage.asset.metadata.dimensions
// const aspectRatio = height / width
// const heroHeight = Math.round(1200)

---

<script>
	// import { gsap } from "gsap";

	// gsap.fromTo(
	// 	'.home-hero__image, .home-hero__intro',
	// 	{ 
	// 		opacity: 0,
	// 		// y: 20,
	// 	},
	// 	{
	// 		opacity: 1,
	// 		// y: 0,
	// 	}
	// );
</script>

<BaseLayout>
	<section class="home-hero-wrapper">
		<div class="u-container">
			<div class="home-hero u-flex u-pad-b-2xl">
				<figure class="home-hero__image">
					<Image 
						src={heroUrl}
						width={728}
						height={860}
						alt={home.heroImage.alt}
						loading="lazy"
					/>				
					<figcaption class="u-pad-2xs u-subtitle smaller">{home.heroImage.caption}</figcaption>
				</figure>
				<div class="home-hero__intro">
					<div>
						<p class="mobile-intro u-subtitle u-mrg-b-2xs">Hi, my name's Sim</p>
						<h1 class="u-fontsize-6 u-font-display u-mrg-be-m">{home.heading}</h1>
						<h3 class="u-fontsize-2 u-font-body u-mrg-be-2xl">{home.intro}</h3>
						<div class="current-status u-flex">
							<div class="orb"></div>
							<p class="u-fontsize-0 u-font-display">{home.workstatus}</p>
						</div>
					</div>
				</div>				
			</div>
		</div>
	</section>

	<section class="work-list-wrapper u-mrg-bs-2xl">
		<div class="u-container">
			<p class="work-list-wrapper__preheading u-subtitle u-mrg-b-m">Some things I've worked on</p>
			<WorkList />
		</div>
	</section>

	<PostList label="Fresh posts" link="blog" />
	
</BaseLayout>

<style>	

	.home-hero {		
		justify-content: space-between;
		border-block-end: 2px solid var(--border-primary);
		flex-direction: column;

		.home-hero__intro {
			display: flex;
			align-items: start;
			gap: var(--space-xs);
			max-width: 800px;
			flex-basis: 100%;
			/* opacity: 0; */

			img {
				display: none;
			}

			.mobile-intro {
				color: var(--text-secondary);
			}

			h1,
			h2 {
				color: var(--accent-2);
			}

			h3 {
				width: 100%;
				text-wrap: pretty;
			}

			.current-status {
				gap: var(--space-2xs);
				align-items: center;
				color: var(--accent-1);
				flex-wrap: nowrap;
				text-wrap: pretty;				

				p {
					flex: 1;
					text-wrap: pretty;
				}
			}
		}		

		.home-hero__image {
			flex: 1;
			max-width: 120px;
			text-align: right;
			/* opacity: 0; */

			img {
				width: 100%;
				height: auto;
				border-radius: 10px;
				border: 2px solid var(--border-third);
			}

			figcaption {
				display: none;
			}
		}
	}	

	@media (min-width: 800px) {

		.home-hero {

			.home-hero__intro {
				flex-basis: 70%;				

				h3 {
					width: 65%;
				}
			}

			.home-hero__image {
				max-width: 200px;
			}
		}

	}

	@media (min-width: 1200px) {
		.home-hero {
			flex-direction: row-reverse;		
			align-items: end;

			.home-hero__intro {
				
				img {
					display: block;
					opacity: .4;
				}
			}

			.home-hero__image {
				max-width: 320px;

				img {
					border-radius: 10px 10px 0px 10px;
				}

				figcaption {
					display: inline-flex;
					background: var(--bg-fourth);
					border-radius: 0px 0px 10px 10px;
					border: 2px solid var(--border-third);
					border-top: none;
				}
			}
		}
	}

	.work-list-wrapper {
		
		.work-list-wrapper__preheading {
			color: var(--text-secondary);
		}
	}
</style>