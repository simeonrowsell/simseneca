---
import BaseLayout from "../layouts/base-layout.astro"
import PostThumb from "../components/post-thumb.astro"

import { Image } from 'astro:assets';
import simProfileImage from '../assets/images/sim_profile.png';

import { GLOBAL_STRINGS } from '../constants/strings';
const bio_blurb = GLOBAL_STRINGS.BIO_BLURB;

// Get all the blog posts
const allPosts = await Promise.all(Object.values(import.meta.glob('./posts/*.md')).map(fn => fn()));
allPosts.sort((a, b) => Date.parse(b.frontmatter.pubDate) - Date.parse(a.frontmatter.pubDate));
const sortedPosts = allPosts.sort((a, b) => Date.parse(b.frontmatter.pubDate) - Date.parse(a.frontmatter.pubDate));
---

<BaseLayout>
	<section class="home-hero-wrapper">
		<div class="u-container">
			<div class="home-hero u-flex u-pad-b-2xl">
				<figure class="home-hero__image">	
					<Image src={simProfileImage} alt="Graphic illustration of Sim smiling in a red shirt on a purple background" />				
					<figcaption class="u-pad-2xs u-subtitle smaller">Me but IRL I'm not a drawing</figcaption>
				</figure>
				<div class="home-hero__intro">
					<img src="/sim_intro.svg" class="u-mrg-bs-s" alt="" role="presentation">
					<div>
						<p class="mobile-intro u-subtitle u-mrg-b-2xs">Hi, I'm Sim</p>
						<h1 class="u-fontsize-6 u-font-display u-mrg-be-xs">A full-stack<br /> Product Designer</h1>
						<h2 class="u-fontsize-3 u-font-display u-mrg-be-l">who also codes and does creative generalist stuff and whatever</h2>
						<h3 class="u-fontsize-1 u-font-body u-mrg-be-2xl">{bio_blurb} Seeking something real in the digital world. Nice to have you along.</h3>
						<div class="current-status u-flex">
							<div class="orb"></div>
							<p class="u-fontsize-0 u-font-display">Independent and up for working with you!</p>
						</div>
					</div>
				</div>				
			</div>
		</div>
	</section>

	<section class="u-container post-list-wrapper">
		<div class="post-list-intro">
			<p class="u-subtitle intro">Fresh posts</p>
			<a href="/blog" class="u-subtitle underlined-link no-inline-padding"><span>All posts â†’</span></a>
		</div>
		<ul class="post-list">
			{sortedPosts.map((post: any) => 
				<PostThumb 
					title={post.frontmatter.title} 
					url={post.url}
					description={post.frontmatter.description}
					edition={post.frontmatter.edition}
					pubDate={post.frontmatter.pubDate}
				/>
			)}
		</ul>
	</section>
</BaseLayout>

<style>

	.home-hero {		
		justify-content: space-between;
		border-block-end: 2px solid var(--border-primary);
		flex-direction: column;

		.home-hero__intro {
			display: flex;
			align-items: start;
			gap: var(--space-xs);
			max-width: 800px;
			flex-basis: 100%;

			img {
				display: none;
			}

			.mobile-intro {
				color: var(--text-secondary);
			}

			h1,
			h2 {
				color: var(--accent-1);
			}

			h3 {
				width: 100%;
				text-wrap: pretty;
			}

			.current-status {
				gap: var(--space-2xs);
				align-items: center;
				color: var(--accent-2);
			}
		}		

		.home-hero__image {
			flex: 1;
			max-width: 120px;
			text-align: right;

			img {
				width: 100%;
				height: auto;
				border-radius: 10px;
				border: 2px solid var(--border-third);
			}

			figcaption {
				display: none;
			}
		}
	}

	.post-list-intro {
		/* .post-list padding + post-thumb__meta width */
		margin-inline-start: calc(var(--space-xl) + 250px);
		padding-inline-start: var(--space-xl);
		padding-block: var(--space-m);
		border-inline-start: 2px solid var(--border-primary);
		display: flex;
		justify-content: space-between;

		.intro {
			color: var(--text-secondary);
		}
	}

	.post-list {
		padding-inline-start: var(--space-xl);
		max-width: max(900px, 70%);

		.post-thumb:last-of-type {
			margin-bottom: ;
		}

		&::after {
			content: '';
			display: block;
			height: var(--space-2xl);
			border-inline-end: 2px solid var(--border-primary);
			/* post-thumb__meta width + 2 to make up for border */
			width: calc(250px + 2px);
		}
	}

	@media (min-width: 800px) {

		.home-hero {

			.home-hero__intro {
				flex-basis: 70%;				

				h3 {
					width: 65%;
				}
			}

			.home-hero__image {
				max-width: 200px;
			}
		}

	}

	@media (min-width: 1200px) {
		.home-hero {
			flex-direction: row-reverse;		
			align-items: end;

			.home-hero__intro {
				
				img {
					display: block;
					opacity: .4;
				}

				.mobile-intro {
					display: none;
				}
			}

			.home-hero__image {
				max-width: 400px;

				img {
					border-radius: 10px 10px 0px 10px;
				}

				figcaption {
					display: inline-flex;
					background: var(--bg-third);
					border-radius: 0px 0px 10px 10px;
					border: 2px solid var(--border-secondary);
					border-top: none;
				}
			}
		}
	}
</style>